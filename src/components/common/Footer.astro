---
import { Icon } from 'astro-icon/components';
import { getHomePermalink } from '~/utils/permalinks';

interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

interface LinkSection {
  title: string;
  links: Array<Link>;
}

export interface Props {
  sections?: Array<LinkSection>;
  secondaryLinks?: Array<Link>;
  socialLinks?: Array<Link>;
  footNote?: string;
  theme?: string;
}

const { sections = [], socialLinks = [], footNote = '', theme = 'light' } = Astro.props;

const buildTime = import.meta.env.BUILD_TIME || '';
const formattedBuildTime = buildTime
  ? new Date(buildTime).toLocaleString('de-DE', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
    })
  : '';
---

<footer class:list={[{ dark: theme === 'dark' }, 'not-prose relative border-t border-gray-200 dark:border-[#2a4b1c]']}>
  <div class="dark:bg-dark pointer-events-none absolute inset-0 dark:bg-none" aria-hidden="true"></div>
  <div class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <!-- Main Footer Content -->
    <div class="grid grid-cols-2 gap-8 py-12 md:grid-cols-4 lg:grid-cols-5 lg:gap-12">
      <!-- About Wohlf체hlgesundheit -->
      <div class="hidden space-y-1 text-center lg:block">
        <a aria-label="Startseite" class="items-center" href={getHomePermalink()}>
          <h3 class="text-lg text-primary dark:text-secondary">wohlf체hlgesundheit.de</h3>
          <p class="text-sm leading-relaxed text-gray-700 dark:text-gray-300">
            Holistische Darmtherapie f체r dein Wohlbefinden. Entdecke den Weg zu mehr Gesundheit und Vitalit채t.
          </p></a
        >
      </div>

      <!-- Dynamic Sections -->
      {
        sections.map((section) => (
          <div class="space-y-1 text-center">
            <h3 class="text-lg text-primary dark:text-secondary">{section.title}</h3>
            <ul class="space-y-1">
              {section.links.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="inline-flex items-center text-sm text-gray-700 transition-colors hover:text-primary dark:text-gray-300 dark:hover:text-secondary"
                  >
                    {link.text}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
      <div class="space-y-1 text-center">
        {
          socialLinks.length > 0 && (
            <div class="space-y-1">
              {socialLinks.map(({ ariaLabel, href, icon }) => (
                <a
                  class="bg-primary/10 dark:bg-secondary/10 inline-flex h-10 w-10 items-center justify-center rounded-lg text-primary transition-all hover:bg-primary hover:text-white dark:text-secondary dark:hover:bg-secondary dark:hover:text-[#2a700d]"
                  aria-label={ariaLabel}
                  href={href}
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  {icon && <Icon name={icon} class="h-10 w-10" />}
                </a>
              ))}
              <p class="text-lg text-primary dark:text-secondary">
                Folge mir
                <br />
                auf Instagram{' '}
              </p>
            </div>
          )
        }
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="border-t border-gray-200 py-6 dark:border-[#2a4b1c]">
      <div class="flex flex-col items-center justify-between gap-4 md:flex-row">
        <!-- Copyright & Legal Links -->
        <div class="text-center text-sm text-gray-600 dark:text-gray-400 md:text-left">
          <Fragment set:html={footNote} />
        </div>

        <!-- Build Time -->
        {
          formattedBuildTime && (
            <div class="text-xs text-gray-500 opacity-50 dark:text-gray-500" title={`Build: ${buildTime}`}>
              {formattedBuildTime}
            </div>
          )
        }
      </div>
    </div>
  </div>
</footer>
